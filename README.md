# PH Evaluator

[![Build Status](https://travis-ci.org/HenryRLee/PokerHandEvaluator.svg?branch=master)](https://travis-ci.org/HenryRLee/PokerHandEvaluator)

A Poker Hand Evaluator based on a Pefect Hash Algorithm

## Overview

Efficiently evaluating a poker hand has been an interesting but challenging
problem. Given two different poker hands, how to determine which one is
stronger? Or more generally, given one poker hand, can we assign a score to
it indicating its strength?

Cactus Kev once gave [an answer](http://suffe.cool/poker/evaluator.html) for
a five-card poker hand evaluation. With smart encoding, it ranks each hand
to 7462 distinct values.

Still, Kev's solution is specific for a five-card hand. To evaluate a
seven-card poker hand (which is more popular because of Texas Hold'em) using
Kev's algorithm, one brute force solution is to iterate all 7 choose 5
combination, running his five-card evaluation algorithm 21 times to find the
best answer, which is apparently too time-inefficient. Omaha poker would be
even more complicated, as it requires picking exactly two cards from four
player's cards, and exactly three cards from five community cards. Using
brute force, it would take 60 iterations (5 choose 3 multiplied by 4 choose 2)
of Kev's 5-card evaluation algorithm.

[PH Evaluator](https://github.com/HenryRLee/PokerHandEvaluator) is designed
for evaluating poker hands with more than 5 cards. Instead of traversing all
the combinations, it uses a perfect hash algorithm to get the hand strength
from a pre-computed hash table, which only costs very few CPU cycles and
considerably small memory (~100kb for the 7 card evaluation). With slight
modification, the same algorithm can be also applied to evaluating Omaha
poker hands.

## Algorithm

This [documentation](Documentation/Algorithm.md) has the description of the
underlying algorithm.

## C/C++ Implementation

The [cpp](cpp) subdirectory has the C/C++ implementation of the algorithm,
offering evaluation from 5-card hands to 7-card hands, as well as Omaha
poker hands.

One of the latest benchmark report generated by Google Benchmark:

```bash
2020-05-23 13:34:11
Running ./benchmark_phevaluator
Run on (2 X 2800.17 MHz CPU s)
CPU Caches:
  L1 Data 32 KiB (x1)
  L1 Instruction 32 KiB (x1)
  L2 Unified 1024 KiB (x1)
  L3 Unified 33792 KiB (x1)
Load Average: 0.89, 0.31, 0.11
-------------------------------------------------------------------
Benchmark                         Time             CPU   Iterations
-------------------------------------------------------------------
EvaluateAllFiveCards       59551513 ns     59549807 ns           12
EvaluateAllSixCards       516360911 ns    516354303 ns            1
EvaluateAllSevenCards    3583711715 ns   3583618594 ns            1
EvaluateRandomFiveCards         233 ns          233 ns      2894078
EvaluateRandomSixCards          242 ns          242 ns      2778563
EvaluateRandomSevenCards        273 ns          273 ns      2700666
EvaluateRandomOmahaCards        471 ns          471 ns      1441785
```

|   | Number of Hands | Time Used | Hands per Second | Memory Used |
|---|---|---|---|---|
| All 5-card Hands | 2598960 | 59551513 ns | 43 M/s | 404K |
| All 6-card Hands | 20358520 | 516360911 ns | 39 M/s | 404K |
| All 7-card Hands | 133784560 | 3583711715 ns | 37 M/s | 404K |
| Random 5-card Hands | 10 | 233 ns | 43 M/s | 404K |
| Random 6-card Hands | 10 | 243 ns | 41 M/s | 404K |
| Random 7-card Hands | 10 | 273 ns | 36 M/s | 404K |
| Random Omaha Hands | 10 | 471 ns | 21 M/s | 404K |

* I didn't measure the memory properly. Basically 404K is the maximum
memory used in all the evaluation methods.

## Python Implementation

The [python](python) subdirectory has the latest python implementation, which is
still in active development. Contributions are welcome.

## Other Implementations

There is a [javascript implementation](https://github.com/thlorenz/phe) using
the same algorithm.

